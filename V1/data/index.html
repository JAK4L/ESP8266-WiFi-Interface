<!DOCTYPE HTML><html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="/highcharts.js"></script>
  <script src="/highcharts-more.js"></script>
  <script src="/solid-gauge.js"></script>
  <!-- <script src="/testdata.php?chart"></script> -->
  <!-- use ESP8266 Server -->

<script src="/ChartConfig"></script>
<style>
.highcharts-figure {
	overflow: auto;
}
.highcharts-figure .chart-container {
	width: 300px;
	height: 200px;
	float: left;
}
.highcharts-figure .chart-container-edit input{
	padding: 3px;
}
.highcharts-figure .chart-container-edit label{
	display: block;
	padding: 5px;
}
.highcharts-figure, .highcharts-data-table table {
	width: 1200px;
	margin: 0 auto;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #EBEBEB;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}
.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}
.highcharts-data-table th {
	font-weight: 600;
    padding: 0.5em;
}
.highcharts-data-table td, .highcharts-data-table th, .highcharts-data-table caption {
    padding: 0.5em;
}
.highcharts-data-table thead tr, .highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}
.highcharts-data-table tr:hover {
    background: #f1f7ff;
}

.edit {
	position: absolute;
	right: 5px;
	top: 5px;
	background: url('/cog-solid.png');
	opacity:0.4;
	display: inline-block;
	width: 30px;
	height:30px;
	text-indent: -99999px;
}

@media (max-width: 600px) {
	.highcharts-figure, .highcharts-data-table table {
		width: 100%;
	}
	.highcharts-figure .chart-container {
		width: 300px;
		float: none;
		margin: 0 auto;
	}

}

</style>
</head>
<body>
  <h2></h2>
  <a class="edit" href="/edit.html">Edit</a>
  <figure id="container" class="highcharts-figure">
  </figure>

</body>

<script>

var config = {
saveAction: '/SaveConfig',
endPoint: '/data?value=',
defaultChartConfig: {
    chart: {
        type: 'solidgauge'
    },
    title: null,
    pane: {
        center: ['50%', '85%'],
        size: '140%',
        startAngle: -90,
        endAngle: 90,
        background: {
            backgroundColor:
                Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
            innerRadius: '60%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },
    exporting: {
        enabled: false
    },
    tooltip: {
        enabled: false
    },
    // the value axis
    yAxis: {
        stops: [
            [0.1, '#55BF3B'], // green
            [0.5, '#DDDF0D'], // yellow
            [0.9, '#DF5353']  // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        title: {
            y: -70
        },
        labels: {
            y: 16
        }
    },
    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: 5,
                borderWidth: 0,
                useHTML: true
            }
        }
    }
}
}

var chartContainer = document.getElementById("container");

chartConfig.forEach(function(con) {

    var node = document.createElement("div");
    node.classList.add('chart-container')
    chartContainer.appendChild(node);
    var chart = Highcharts.chart(node, Highcharts.merge(config.defaultChartConfig, {
        yAxis: {
            min: con.min,
            max: con.max,
            title: {
                text: con.title
            }
        },
        credits: {
            enabled: false
        },
        series: [{
            name: con.title,
            data: [con.initialValue],
            dataLabels: {
                format:
                    '<div style="text-align:center">' +
                    '<span style="font-size:25px">{y}</span><br/>' +
                    '<span style="font-size:12px;opacity:0.4">' + con.valueSuffix + '</span>' +
                    '</div>'
            },
            tooltip: {
                valueSuffix: con.valueSuffix
            }
        }]
    }));

    setInterval(function ( ) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var point,
            newVal,
            inc;
      	if (chart) {
      		point = chart.series[0].points[0];
      		inc = parseFloat(this.responseText);
      		newVal =  inc;
      		point.update(newVal);
      	}
        }
      };
      xhttp.open("GET", config.endPoint + con.prefix, true);
      xhttp.send();
    }, con.updateFrequency);


});



</script>
</html>
